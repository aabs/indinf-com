---
layout: post
title: Using RDF and C# to create an MP3 Manager - Part 3
date: 2007-05-08 09:07:17.000000000 +10:00
type: post
published: true
status: publish
categories: []
tags:
- C#
- Computer Science
- LINQ
- programming
- software
meta: {}
author:
  login: aabs
  email: matthews.andrew@gmail.com
  display_name: Andrew Matthews
  first_name: Andrew
  last_name: Matthews
---
<p>Last time I hurriedly showed you how you can perform the next step of converting a triple store into an ORM system of sorts. The purpose of all this activity, and the reason I left off blogging about LINQ was that I am working on a system to allow me to use LINQ with a triple store and reasoner. The benefit of doing so is that we should have a lot of the benefits of the modern relational world with the power and connectivity of the new world of the semantic web. In this post I shall outline the steps required to start working with LINQ to RDF (as I've chosen to call it through lack of imagination).</p>
<p>I've been using test driven development throughout, so I already have a few 'integration' unit tests to show you:</p>
<p><code>[TestMethod]<br />
public void Query()<br />
{<br />
&nbsp;&nbsp;string urlToRemoteSparqlEndpoint = "http://localhost/MyMusicService/SparqlQuery.ashx";<br />
&nbsp;&nbsp;RdfContext&lt;Track&gt; ctx = new RdfSparqlContext&lt;Track&gt;(urlToRemoteSparqlEndpoint);<br />
&nbsp;&nbsp;var titles = from t in ctx<br />
&nbsp;&nbsp;&nbsp;&nbsp;where t.Year &gt; 1998 &amp;&amp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;t.GenreName == "Ambient Techno" ||<br />
&nbsp;&nbsp;&nbsp;&nbsp;t.GenreName == "Chillout"<br />
&nbsp;&nbsp;&nbsp;&nbsp;select t.Title;<br />
&nbsp;&nbsp;foreach(string title in titles)<br />
&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(title);<br />
}</code></p>
<p>In English, this means that rather than manipulating a local triple store, I want the RdfSparqlContext to compose a SPARQL query and present it to the query endpoint found at location urlToRemoteSparqlEndpoint. I then want it to deserialise the results returned and store them in titles. This is a nice mixture of new features from .NET 3.5, combined with some of the features I've already developed for object deserialisation.</p>
<p>With the example above I am concerned more with the querying aspect of LINQ (it being a query language n' all!) but that is not much use to me in the world of transactional web development where I find myself mired for the moment, so we need full CRUD behaviour from this system. Here's a unit test for object update.</p>
<p><code>[TestMethod]<br />
public void Update()<br />
{<br />
&nbsp;&nbsp;string urlToRemoteSparqlEndpoint = @"http://localhost/MyMusicService/SparqlQuery.ashx";<br />
&nbsp;&nbsp;RdfContext&lt;Track&gt; ctx = new RdfSparqlContext&lt;Track&gt;(urlToRemoteSparqlEndpoint);<br />
&nbsp;&nbsp;var q = from t in ctx<br />
&nbsp;&nbsp;&nbsp;&nbsp;where t.Year &gt; 1998 &amp;&amp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;t.GenreName == "Ambient Techno" ||<br />
&nbsp;&nbsp;&nbsp;&nbsp;t.GenreName == "Chillout"<br />
&nbsp;&nbsp;&nbsp;&nbsp;select t;<br />
&nbsp;&nbsp;foreach (Track t in q)<br />
&nbsp;&nbsp;&nbsp;&nbsp;t.Rating = 5;<br />
&nbsp;&nbsp;ctx.AcceptChanges();<br />
}</code></p>
<p>Here, I'm getting a bunch of objects back from the triple store, modifying their Rating property and then asking for those changes to be stored. This follows the usage patterns for LINQ to SQL.</p>
<p>To satisfy these unit tests (plus ones for the rest of the CRUD behaviour and with support for N3, in-memory and RDBMS based local triple stores is what I'm aiming to complete - eventually. Here's the general scheme for implementing querying using LINQ. It assumes that RDF data structures are taken unmodified from the SemWeb library.</p>
<ul>
<li>Create a Query Object (I guess this would be our RdfContext class above)</li>
<li>Implement IQueryable&lt;T&gt; on it.</li>
<li>When the enumerable is requested, convert the stored expression tree into the target language</li>
<li>Present it to whatever store or endpoint is available,</li>
<li>Deserialise the results into objects</li>
<li>Yield the results (probably as they are being deserialised)</li>
</ul>
<p>This is a very broad outline of the tasks. I'll explain in a lot more depth in subsequent posts, as I tackle each step.</p>
